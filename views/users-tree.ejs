<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h3><%= translations.user_tree %></h3>
                <div id="user-tree">
                    <%- renderUserTree(userTree) %>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
  function toggleChildren(userId) {
    var childrenElement = document.getElementById('children-' + userId);
    var toggleButton = document.getElementById('toggle-' + userId);

    if (childrenElement.style.display === 'none') {
      childrenElement.style.display = 'block';
      toggleButton.textContent = '-';
    } else {
      childrenElement.style.display = 'none';
      toggleButton.textContent = '+';
    }
  }
</script>

<%
function renderUserTree(users) {
    var html = '<ul class="list-group">';
    for (var i = 0; i < users.length; i++) {
        var user = users[i];
        html += '<li class="list-group-item">';
        html += '<div class="d-flex justify-content-between align-items-center">';
        html += '<div>';
        if (user.children.length > 0) {
            html += '<button id="toggle-' + user.id + '" class="btn btn-sm btn-outline-secondary me-2" onclick="toggleChildren(' + user.id + ')">+</button>';
        }
        html += '<span>' + user.username + '</span>';
        html += '</div>';
        html += '<div>';
        html += '<span class="me-3">Balance: ' + (user.balance / 100).toFixed(2) + '</span>';
        html += '<span class="me-3">Registered: ' + user.registrationDate + '</span>';
        html += '<button class="btn btn-sm btn-primary issue-points-btn" data-user-id="' + user.id + '" data-username="' + user.username + '">';
        html += translations.issue_points;
        html += '</button>';
        html += '</div>';
        html += '</div>';
        if (user.children.length > 0) {
            html += '<div id="children-' + user.id + '" style="display:none; margin-left: 20px;">' + renderUserTree(user.children) + '</div>';
        }
        html += '</li>';
    }
    html += '</ul>';
    return html;
}
%>
